{% load static %}
{% include 'admin_navigation.html' %}

<head>
<style>
  .dashboard-card {
    border-radius: 15px;
    transition: all 0.3s ease;
    cursor: pointer;
    color: #fff;
    border: none;
  }
  .dashboard-card:hover {
    transform: translateY(-5px);
    box-shadow: 0px 8px 20px rgba(0,0,0,0.2);
  }
  .dashboard-card h4 {
    font-size: 2rem;
    font-weight: bold;
    margin: 0;
  }
  .dashboard-card p {
    margin: 0;
    font-size: 1rem;
    letter-spacing: 0.5px;
  }
  .dashboard-icon {
    font-size: 2rem;
    margin-bottom: 10px;
  }
  .dashboard-link {
    text-decoration: none;
    color: inherit;
  }
  .bg-jobseekers { background: linear-gradient(135deg, #00c6ff, #0072ff); }
  .bg-recruiters { background: linear-gradient(135deg, #42e695, #3bb2b8); }
  .bg-jobs { background: linear-gradient(135deg, #f7971e, #ffd200); }
  .bg-feedback { background: linear-gradient(135deg, #ff0844, #ffb199); }

  .analytics-section { margin-left: 5px; margin-right: 5px; }

  .data-card {
    min-height: 350px;
    overflow-y: auto;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .data-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
  }
</style>
</head>

<div class="container mt-4">
  <h2 class="mb-4">Reports & Analytics</h2>

  <!-- Summary Cards -->
  <div class="row mb-4">
    <div class="col-md-3">
      <a href="{% url 'view_users' %}" class="dashboard-link">
        <div class="card text-center p-4 shadow-sm dashboard-card bg-jobseekers">
          <i class="fas fa-users dashboard-icon"></i>
          <h4>{{ total_users }}</h4>
          <p>Job Seekers</p>
        </div>
      </a>
    </div>

    <div class="col-md-3">
      <a href="{% url 'recruiter_all' %}" class="dashboard-link">
        <div class="card text-center p-4 shadow-sm dashboard-card bg-recruiters">
          <i class="fas fa-user-tie dashboard-icon"></i>
          <h4>{{ total_recruiters }}</h4>
          <p>Recruiters</p>
        </div>
      </a>
    </div>

    <div class="col-md-3">
      <a href="{% url 'latestadmin' %}" class="dashboard-link">
        <div class="card text-center p-4 shadow-sm dashboard-card bg-jobs">
          <i class="fas fa-briefcase dashboard-icon"></i>
          <h4>{{ total_jobs }}</h4>
          <p>Total Jobs</p>
        </div>
      </a>
    </div>

    <div class="col-md-3">
      <a href="{% url 'view_feedback' %}" class="dashboard-link">
        <div class="card text-center p-4 shadow-sm dashboard-card bg-feedback">
          <i class="fas fa-comments dashboard-icon"></i>
          <h4>{{ total_feedback }}</h4>
          <p>Feedbacks</p>
        </div>
      </a>
    </div>
  </div>

  <!-- Data Lists -->
  <div class="row">
    <!-- Jobs by Category -->
    <div class="col-md-4">
      <div class="card shadow-sm mb-4 data-card">
        <div class="card-header bg-info text-white">
          <i class="fas fa-tags"></i> Jobs by Category
        </div>
        <div class="card-body">
          <ul class="list-unstyled">
            {% if jobs_by_category %}
              {% for item in jobs_by_category %}
                <li>
                  {{ item.category|default:item.title }}:
              <li>{{ item.title }}: <strong>{{ item.count }}</strong></li>
            {% empty %}
              <li>No data available</li>
                </li>
              {% endfor %}
            {% else %}
              <p>No categories found</p>
            {% endif %}
          </ul>
        </div>
      </div>
    </div>

    <!-- Applications per User -->
    <div class="col-md-4">
      <div class="card shadow-sm mb-4 data-card">
        <div class="card-header bg-success text-white">
          <i class="fas fa-user"></i> Applications per User
        </div>
        <div class="card-body">
          <ul class="list-unstyled">
            {% if applications_per_user %}
              {% for item in applications_per_user %}
                <li>
                  <strong>{{ item.student__user__username }}</strong>
                  â†’ {{ item.count }} applications
                </li>
              {% endfor %}
            {% else %}
              <p>No applications found</p>
            {% endif %}
          </ul>
        </div>
      </div>
    </div>

    <!-- Applications per Job -->
    <div class="col-md-4">
      <div class="card shadow-sm mb-4 data-card">
        <div class="card-header bg-warning text-dark">
          <i class="fas fa-briefcase"></i> Applications per Job
        </div>
        <div class="card-body">
          <ul class="list-unstyled">
            {% if applications_per_job %}
              {% for item in applications_per_job %}
                <li>{{ item.job__title }}: <strong>{{ item.count }}</strong></li>
              {% endfor %}
            {% else %}
              <p>No applications found</p>
            {% endif %}
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts -->
  <h2 class="mb-4">Visual Reports</h2>
  <div class="row">
    <div class="col-md-12">
      <div class="card shadow-sm mb-4" style="min-height: 400px;">
        <div class="card-header bg-primary text-white">
          <i class="fas fa-map-marker-alt"></i> Jobs by Location
        </div>
        <div class="card-body">
          <canvas id="jobsLocationChart" style="width:100%; height:350px;"></canvas>
        </div>
      </div>
    </div>

    <div class="col-md-12">
      <div class="card shadow-sm mb-4" style="min-height: 400px;">
        <div class="card-header bg-info text-white">
          <i class="fas fa-chart-pie"></i> Jobs by Category
        </div>
        <div class="card-body">
          <canvas id="jobsCategoryChart" style="width:100%; height:350px;"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Chart.js & FontAwesome -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<script>
  // Jobs by Location Chart
  const locCtx = document.getElementById('jobsLocationChart').getContext('2d');
  new Chart(locCtx, {
    type: 'bar',
    data: {
      labels: [{% for item in jobs_by_location %}'{{ item.location }}',{% endfor %}],
      datasets: [{
        label: 'Jobs by Location',
        data: [{% for item in jobs_by_location %}{{ item.count }},{% endfor %}],
        backgroundColor: 'rgba(54, 162, 235, 0.7)',
        borderColor: 'rgba(54, 162, 235, 1)',
        borderWidth: 1
      }]
    },
    options: { responsive: true, scales: { y: { beginAtZero: true } } }
  });

  // Jobs by Category Chart
  const catCtx = document.getElementById('jobsCategoryChart').getContext('2d');
  new Chart(catCtx, {
    type: 'doughnut',
    data: {
      labels: [{% for item in jobs_by_category %}'{{ item.category|default:item.title }}',{% endfor %}],
      datasets: [{
        label: 'Jobs by Category',
        data: [{% for item in jobs_by_category %}{{ item.count }},{% endfor %}],
        backgroundColor: [
          '#007bff', '#28a745', '#ffc107', '#dc3545', '#17a2b8', '#6f42c1'
        ]
      }]
    },
    options: { responsive: true, maintainAspectRatio: false }
  });
</script>
