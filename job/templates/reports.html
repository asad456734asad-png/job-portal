{% load static %}
{% include 'admin_navigation.html' %}
<head>
  <style>
    .card-fixed {
      height: 300px;       /* equal height for all */
      overflow-y: auto;    /* scrolls inside if content too long */
    }
  </style>
</head>

<div class="container mt-4">
  <h2 class="mb-4">Reports & Analytics</h2>

  <!-- Summary Cards -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card text-center p-3 shadow-sm">
        <h4>{{ total_users }}</h4>
        <p>Job Seekers</p>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center p-3 shadow-sm">
        <h4>{{ total_recruiters }}</h4>
        <p>Recruiters</p>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center p-3 shadow-sm">
        <h4>{{ total_jobs }}</h4>
        <p>Total Jobs</p>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center p-3 shadow-sm">
        <h4>{{ total_feedback }}</h4>
        <p>Feedbacks</p>
      </div>
    </div>
  </div>

  <!-- Data Cards -->
  <div class="row">
    <!-- Jobs by Category -->
    <div class="col-md-4">
      <div class="card shadow-sm mb-4 h-100">
        <div class="card-header bg-info text-white">
          <i class="fas fa-tags"></i> Jobs by Category
        </div>
        <div class="card-body card-fixed">
          <ul class="list-unstyled">
            {% for item in jobs_by_category %}
              <li>{{ item.title }}: <strong>{{ item.count }}</strong></li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <!-- Applications per User -->
    <div class="col-md-4">
      <div class="card shadow-sm mb-4 h-100">
        <div class="card-header bg-success text-white">
          <i class="fas fa-user"></i> Applications per User
        </div>
        <div class="card-body card-fixed">
          <ul class="list-unstyled">
            {% for item in applications_per_user %}
              <li>
                <strong>{{ item.student__user__username }}</strong> â†’ {{ item.job__title }} ({{ item.count }})
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <!-- Applications per Job -->
    <div class="col-md-4">
      <div class="card shadow-sm mb-4 h-100">
        <div class="card-header bg-warning text-dark">
          <i class="fas fa-briefcase"></i> Applications per Job
        </div>
        <div class="card-body card-fixed">
          <ul class="list-unstyled">
            {% for item in applications_per_job %}
              <li>{{ item.job__title }}: <strong>{{ item.count }}</strong></li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <h4 class="mt-4">Visual Reports</h4>
  <div class="row">
    <!-- Jobs by Location (Bar Chart) -->
    <div class="col-md-6">
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
          <i class="fas fa-map-marker-alt"></i> Jobs by Location
        </div>
        <div class="card-body">
          <canvas id="jobsLocationChart" style="max-width:100%; height:300px;"></canvas>
        </div>
      </div>
    </div>

    <!-- Jobs by Category (Doughnut Chart) -->
    <div class="col-md-6">
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-secondary text-white">
          <i class="fas fa-chart-pie"></i> Jobs by Category
        </div>
        <div class="card-body">
          <canvas id="jobsCategoryChart" style="max-width:100%; height:300px;"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Chart.js & FontAwesome -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<script>
  // Jobs by Location Chart (Bar)
  const locCtx = document.getElementById('jobsLocationChart').getContext('2d');
  new Chart(locCtx, {
    type: 'bar',
    data: {
      labels: [{% for item in jobs_by_location %}'{{ item.location }}',{% endfor %}],
      datasets: [{
        label: 'Jobs by Location',
        data: [{% for item in jobs_by_location %}{{ item.count }},{% endfor %}],
        backgroundColor: 'rgba(54, 162, 235, 0.7)',
        borderColor: 'rgba(54, 162, 235, 1)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      scales: { y: { beginAtZero: true } }
    }
  });

  // Jobs by Category Chart (Doughnut)
  const catCtx = document.getElementById('jobsCategoryChart').getContext('2d');
  new Chart(catCtx, {
    type: 'doughnut',
    data: {
      labels: [{% for item in jobs_by_category %}'{{ item.title }}',{% endfor %}],
      datasets: [{
        label: 'Jobs by Category',
        data: [{% for item in jobs_by_category %}{{ item.count }},{% endfor %}],
        backgroundColor: [
          '#007bff', '#28a745', '#ffc107', '#dc3545', '#17a2b8', '#6f42c1'
        ]
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false
    }
  });
</script>
